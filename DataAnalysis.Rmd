---
title: "Parakeets"
output: html_notebook
---

```{r setup}
rm(list=ls())
setwd("/Users/jamese.richardson/Projects/Masters/stats_poster")
list.files()

library(tidyverse)
library(ggplot2)
library(vegan)
```

```{r}
birdData <- read_csv("birds.csv")
head(birdData)

birdDataCountsOnly <- birdData[birdData$count != 'X',]
birdDataCountsOnly$count_num <- as.numeric(birdDataCountsOnly$count)
```

```{r}
birdTable <- with(birdDataCountsOnly, tapply(count_num, list(site, species), FUN = mean, default=0))
head(birdTable)
```


```{r}
birdDataDf <- as.data.frame.matrix(birdTable)


library(data.table)
birdDataDf <- setDT(birdDataDf, keep.rownames = TRUE)[]
colnames(birdDataDf)[colnames(birdDataDf)=="rn"] <- "Site"
head(birdDataDf)
names(birdDataDf) <- make.names(names(birdDataDf), unique = TRUE)

birdDataDf
```


```{r}
parkData <- read_csv("parkdata.csv")
head(parkData)
allData <- inner_join(birdDataDf, parkData,by="Site")
head(allData)
```

```{r}
names(allData)
```

species data: 2:10
env data: 12:15

```{r}
names(allData[2:10])
```

```{r}
names(allData[12:17])
```

```{r}
spp.rich <- specnumber(allData[2:10], MARGIN=1) 
shannon <- diversity(allData[2:10])

enrichedData <- cbind(allData, spp.rich, shannon)
head(enrichedData)

enrichedData$has_parakeet <- ifelse(enrichedData$Ring.necked.Parakeet==0, "No", "Yes")

head(enrichedData)
```

```{r}
ggplot(enrichedData, aes(x=has_parakeet, y=shannon)) + 
  geom_boxplot()

```

```{r}
ggplot(enrichedData, aes(x=has_parakeet, y=spp.rich)) + 
  geom_boxplot()

```



```{r}
ggplot(enrichedData, aes(x=Ring.necked.Parakeet, y=shannon)) + 
  geom_point()

```

```{r}
names(enrichedData)
speciesShapiro <- sapply(enrichedData[2:10], shapiro.test)
speciesShapiro[2,]
```
```{r}
names(enrichedData)
envShapiro <- sapply(enrichedData[12:17], shapiro.test)
envShapiro[2,]
```

```{r}
enrichedData[12:17]
data.frame(sapply(enrichedData[12:17], sqrt))

envShapiroSqrt <- sapply(data.frame(sapply(enrichedData[12:17], sqrt)), shapiro.test)
envShapiroSqrt[2,]
```

```{r}
envLogDf <- data.frame(sapply(enrichedData[12:17], function(v) { l = log10(v); ifelse(v == -Inf, 0, v)}))
envShapiroLog <- sapply(envLogDf, shapiro.test)
envShapiroLog[2,]
```


```{r}
nmds <- metaMDS(enrichedData[2:10], k=2, trymax = 30) 

plot(nmds, display = "sites")
with(enrichedData, ordiellipse(nmds, has_parakeet, col=4, lwd=2, draw = "polygon", kind = c("sd"))) 
with(enrichedData, ordispider(nmds, has_parakeet, label=TRUE))
```

```{r}
  ef <- envfit(nmds, enrichedData[12:17], na.rm = TRUE, permu = 999) 
  ef
```


```{r}
plot(nmds, display = "sites")
with(enrichedData, ordiellipse(nmds, has_parakeet, col=4, lwd=2, draw = "polygon", kind = c("sd")), label=T) 
plot(ef, p.max = 0.2)
with(enrichedData, ordispider(nmds, has_parakeet, label=TRUE))
```




---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------
OLD DATA:
---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------

```{r}
data  <- read_csv("Data.csv")
head(data)
```

```{r}
names(data)
data[4:12]
```


```{r}
cor(data[5:13])
```

```{r}
names(data)
names(data[5:13])
spp.rich <- specnumber(data[5:13], MARGIN=1) 
shannon <- diversity(data[5:13])

spp.rich.without.parakeet <- specnumber(data[6:13], MARGIN=1) 
shannon.without.parakeet <- diversity(data[6:13])

data <- cbind(data, spp.rich, shannon, spp.rich.without.parakeet, shannon.without.parakeet)

names(data)
ggplot(data, aes(x=city, y=shannon)) + 
  geom_boxplot()


ggplot(data, aes(x=city, y=spp.rich.without.parakeet)) + 
  geom_boxplot()

ggplot(data, aes(x=city_type, y=spp.rich.without.parakeet)) + 
  geom_boxplot()
```

```{r}
ggplot(data, aes(x=city, y=spp.rich)) + 
  geom_boxplot()
```

```{r}
nmds <- metaMDS(data[5:13], k=2, trymax = 30) 

nmds.no.parakeet <- metaMDS(data[6:13], k=2, trymax = 30) 

```

```{r}
plot(nmds, display = "sites")
with(data, ordiellipse(nmds, city, col=4, lwd=2, draw = "polygon", kind = c("sd"))) 
with(data, ordispider(nmds, city, label=TRUE))
```


```{r}
plot(nmds, display = "sites")
with(data, ordiellipse(nmds.no.parakeet, city_type, col=4, lwd=2, draw = "polygon", kind = c("sd"))) 
with(data, ordispider(nmds.no.parakeet, city_type, label=TRUE))
```




```{r}
names(data)
names(data[14:24])
pairs(data[14:24])
```

```{r}
names(data)
cor(data[14:24])
```

```{r}

ef <- envfit(nmds, data[14:24], na.rm = TRUE, permu = 999) 
ef

```

```{r}

ef.with.parakeet <- envfit(nmds, data[c(5, 14:24)], na.rm = TRUE, permu = 999) 
ef.with.parakeet

```



```{r}
plot(nmds, display = "sites")
with(data, ordiellipse(nmds, city, col=4, lwd=2, draw = "polygon", kind = c("sd"))) 
plot(ef, p.max = 0.1)
```

```{r}
#jpeg(filename="communities.jpg")
plot(nmds.no.parakeet, display = "sites")
with(data, ordiellipse(nmds.no.parakeet, city_type, col=4, lwd=2, draw = "polygon", kind = c("sd")), label=T) 
plot(ef.with.parakeet, p.max = 0.1)
with(data, ordispider(nmds.no.parakeet, city_type, label=TRUE))
#dev.off()
```



```{r}
env.pca <- rda(data[14:24], scale=TRUE) 
summary(env.pca)
biplot(env.pca)

```


```{r}
names(data)
```


```{r}
model1 <- lm(nuthatch~parakeet + perc_large_tree_cover + area_hect + distance_city_km, data = data)
summary(model1)
```
```{r}
model2 <- lm(nuthatch~parakeet * perc_large_tree_cover * area_hect * distance_city_km, data = data)
summary(model2)
```

```{r}
model3 <- glm(spp.rich~parakeet + large_tree_cover_hect + area_hect + distance_city_km + shrub_cover_hect, data = data[data$city == 'Manchester',], family=poisson)
summary(model3)
```


```{r}
model4 <- glm(spp.rich~parakeet * large_tree_cover_hect * area_hect * distance_city_km * shrub_cover_hect, data = data[data$city == 'Manchester',], family=poisson)
summary(model4)
```




```{r}
model5 <- glm(shannon~parakeet + large_tree_cover_hect + area_hect + distance_city_km + shrub_cover_hect, data = data[data$city == 'Manchester',], family=poisson)
summary(model5)
```



```{r}
model6 <- glm(spp.rich~great_spotted_woodpecker + large_tree_cover_hect + area_hect + distance_city_km + shrub_cover_hect, data = data[data$city == 'Manchester',], family=poisson)
summary(model6)
```



```{r}
model7 <- glm(spp.rich~great_spotted_woodpecker * large_tree_cover_hect * area_hect * distance_city_km * shrub_cover_hect, data = data[data$city == 'Manchester',], family=poisson)
summary(model7)
```